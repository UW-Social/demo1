{"version":3,"file":"Publish-CiAZUD5B.js","sources":["../../src/components/EventForm.vue"],"sourcesContent":["<template>\n  <div class=\"event-form\">\n    <h2>Publish New Event</h2>\n    <form @submit.prevent=\"handleSubmit\">\n      <div class=\"form-group\">\n        <label for=\"title\">Event Title</label>\n        <input\n          id=\"title\"\n          v-model=\"formData.title\"\n          type=\"text\"\n          required\n          placeholder=\"Enter event title\"\n        >\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"description\">Description</label>\n        <textarea\n          id=\"description\"\n          v-model=\"formData.description\"\n          type=\"text\"\n          required\n          :placeholder=\"descriptionPlaceholder\"\n          rows=\"3\"\n        ></textarea>\n      </div>\n\n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"startDate\">Start Date</label>\n          <input\n            id=\"startDate\"\n            v-model=\"formData.startDate\"\n            type=\"date\"\n            required\n          >\n        </div>\n        <div class=\"form-group\">\n          <label for=\"startTime\">Start Time</label>\n          <input\n            id=\"startTime\"\n            v-model=\"formData.startTime\"\n            type=\"time\"\n            required\n          >\n        </div>\n      </div>\n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"endDate\">End Date</label>\n          <input\n            id=\"endDate\"\n            v-model=\"formData.endDate\"\n            type=\"date\"\n            required\n          >\n        </div>\n        <div class=\"form-group\">\n          <label for=\"endTime\">End Time</label>\n          <input\n            id=\"endTime\"\n            v-model=\"formData.endTime\"\n            type=\"time\"\n            required\n          >\n        </div>\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"location\">Location</label>\n        <input\n          id=\"location\"\n          v-model=\"formData.location\"\n          type=\"text\"\n          required\n          placeholder=\"Event location\"\n        >\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"category\">Category</label>\n        <select id=\"category\" v-model=\"formData.category\" required>\n          <option value=\"\">Select category</option>\n          <option value=\"Academic\">Academic</option>\n          <option value=\"Club\">Club</option>\n          <option value=\"Sports\">Sports</option>\n          <option value=\"Games\">Games</option>\n          <option value=\"Culture\">Culture</option>\n          <option value=\"Interest\">Interest</option>\n          <option value=\"HFS\">HFS</option>\n          <!-- <option value=\"other\">Other</option> -->\n        </select>\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"maxParticipants\">Max Participants (Optional)</label>\n        <input\n          id=\"maxParticipants\"\n          v-model=\"formData.maxParticipants\"\n          type=\"number\"\n          min=\"1\"\n          placeholder=\"No limit if not set\"\n        >\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"tags\">Tags (comma separated)</label>\n        <input\n          id=\"tags\"\n          v-model=\"tagsInput\"\n          type=\"text\"\n          placeholder=\"e.g., study, social, sports\"\n        >\n      </div>\n\n      <!-- <div class=\"form-group\">\n        <label for=\"image\">Event Image (Optional)</label>\n        <input\n          id=\"image\"\n          type=\"file\"\n          accept=\"image/*\"\n          @change=\"handleImageUpload\"\n        > -->\n\n      <div class=\"form-group\">\n        <label for=\"link\">Event Link (Optional)</label>\n        <input\n          id=\"link\"\n          v-model=\"formData.link\"\n          type=\"url\"\n          placeholder=\"e.g., https://meeting.com/your-event\"\n        >\n      </div>\n\n      <button type=\"submit\" class=\"submit-btn\" :disabled=\"isSubmitting\">\n        {{ isSubmitting ? 'Publishing...' : 'Publish!' }}\n      </button>\n    </form>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { useUserStore } from '../stores/user';\nimport { useEventStore } from '../stores/event';\nimport { collection, addDoc,Timestamp } from 'firebase/firestore';\nimport { db } from '../firebase/config';\nimport type { Event } from '../types/event';\n\nconst router = useRouter();\nconst userStore = useUserStore();\nconst eventStore = useEventStore();\nconst isSubmitting = ref(false);\n\nconst formData = ref({\n  title: '',\n  description: '',\n  startDate: '',\n  startTime: '',\n  endDate: '',\n  endTime: '',\n  location: '',\n  category: '',\n  maxParticipants: null as number | null,\n  tags: [] as string[],\n  link: '',\n});\n\nconst tagsInput = computed({\n  get: () => formData.value.tags.join(', '),\n  set: (value) => {\n    formData.value.tags = value.split(',').map(tag => tag.trim()).filter(Boolean);\n  }\n});\n\n// 新增：动态 placeholder\nconst descriptionPlaceholder = computed(() =>\n  formData.value.title\n    ? `Come and enjoy ${formData.value.title}!`\n    : 'Describe your event here...'\n);\n\nconst handleSubmit = async () => {\n  if (!userStore.userProfile) {\n    alert('Please log in to publish an event!');\n    return;\n  }\n\n  isSubmitting.value = true;\n  try {\n    const start = new Date(`${formData.value.startDate}T${formData.value.startTime}`);\n    const end = new Date(`${formData.value.endDate}T${formData.value.endTime}`);\n    if (start >= end) {\n      alert('End time must be after start time.');\n      return;\n    }\n    // Prepare eventData with maxParticipants as number or undefined\n    const {\n      maxParticipants,\n      ...restFormData\n    } = formData.value;\n\n    const eventData: Omit<Event, 'id'> = {\n      title: formData.value.title,\n      description: formData.value.description,\n      location: formData.value.location,\n      category: formData.value.category,\n      tags: formData.value.tags,\n      startime: Timestamp.fromDate(start),\n      endtime: Timestamp.fromDate(end),\n      maxParticipants: formData.value.maxParticipants,\n      organizerId: userStore.userProfile.uid,\n      organizerName: userStore.userProfile.displayName || 'Anonymous',\n      organizerAvatar: userStore.userProfile.photoURL || '',\n      createdAt: new Date().toISOString(),\n      participants: [],\n      link: formData.value.link,\n    };\n\n    await addDoc(collection(db, 'events'), eventData);\n    alert('Successfully published!');\n\n    // 更新全局事件列表\n    await eventStore.fetchEvents();\n\n    router.push('/events');\n  } catch (error) {\n    console.error('Failed to publish event:', error);\n    alert('Failed to publish event.');\n  } finally {\n    isSubmitting.value = false;\n  }\n};\n</script>\n\n<style scoped>\n.event-form {\n  max-width: 800px;\n  margin: 2rem auto;\n  padding: 2rem;\n  background: white;\n  border-radius: 15px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\nh2 {\n  color: #333;\n  margin-bottom: 2rem;\n  text-align: center;\n}\n\nlabel {\n  display: block;\n  margin-bottom: 0.5rem;\n  color: #666;\n  font-weight: 500;\n}\n#description::placeholder {\n  font-weight: 500;\n}\n#title,\n#description,\n#location {\n  /* font-weight: 600; */\n  border-width: 2px;\n}\n\n</style>"],"names":["router","useRouter","userStore","useUserStore","eventStore","useEventStore","isSubmitting","ref","formData","tagsInput","computed","value","tag","descriptionPlaceholder","handleSubmit","start","end","maxParticipants","restFormData","eventData","Timestamp","addDoc","collection","db","error"],"mappings":"0lBAsJA,MAAMA,EAASC,EAAU,EACnBC,EAAYC,EAAa,EACzBC,EAAaC,EAAc,EAC3BC,EAAeC,EAAI,EAAK,EAExBC,EAAWD,EAAI,CACnB,MAAO,GACP,YAAa,GACb,UAAW,GACX,UAAW,GACX,QAAS,GACT,QAAS,GACT,SAAU,GACV,SAAU,GACV,gBAAiB,KACjB,KAAM,CAAC,EACP,KAAM,EAAA,CACP,EAEKE,EAAYC,EAAS,CACzB,IAAK,IAAMF,EAAS,MAAM,KAAK,KAAK,IAAI,EACxC,IAAMG,GAAU,CACdH,EAAS,MAAM,KAAOG,EAAM,MAAM,GAAG,EAAE,IAAIC,GAAOA,EAAI,KAAM,CAAA,EAAE,OAAO,OAAO,CAAA,CAC9E,CACD,EAGKC,EAAyBH,EAAS,IACtCF,EAAS,MAAM,MACX,kBAAkBA,EAAS,MAAM,KAAK,IACtC,6BACN,EAEMM,EAAe,SAAY,CAC3B,GAAA,CAACZ,EAAU,YAAa,CAC1B,MAAM,oCAAoC,EAC1C,MAAA,CAGFI,EAAa,MAAQ,GACjB,GAAA,CACI,MAAAS,EAAY,IAAA,KAAK,GAAGP,EAAS,MAAM,SAAS,IAAIA,EAAS,MAAM,SAAS,EAAE,EAC1EQ,EAAU,IAAA,KAAK,GAAGR,EAAS,MAAM,OAAO,IAAIA,EAAS,MAAM,OAAO,EAAE,EAC1E,GAAIO,GAASC,EAAK,CAChB,MAAM,oCAAoC,EAC1C,MAAA,CAGI,KAAA,CACJ,gBAAAC,EACA,GAAGC,IACDV,EAAS,MAEPW,EAA+B,CACnC,MAAOX,EAAS,MAAM,MACtB,YAAaA,EAAS,MAAM,YAC5B,SAAUA,EAAS,MAAM,SACzB,SAAUA,EAAS,MAAM,SACzB,KAAMA,EAAS,MAAM,KACrB,SAAUY,EAAU,SAASL,CAAK,EAClC,QAASK,EAAU,SAASJ,CAAG,EAC/B,gBAAiBR,EAAS,MAAM,gBAChC,YAAaN,EAAU,YAAY,IACnC,cAAeA,EAAU,YAAY,aAAe,YACpD,gBAAiBA,EAAU,YAAY,UAAY,GACnD,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,aAAc,CAAC,EACf,KAAMM,EAAS,MAAM,IACvB,EAEA,MAAMa,EAAOC,EAAWC,EAAI,QAAQ,EAAGJ,CAAS,EAChD,MAAM,yBAAyB,EAG/B,MAAMf,EAAW,YAAY,EAE7BJ,EAAO,KAAK,SAAS,QACdwB,EAAO,CACN,QAAA,MAAM,2BAA4BA,CAAK,EAC/C,MAAM,0BAA0B,CAAA,QAChC,CACAlB,EAAa,MAAQ,EAAA,CAEzB"}